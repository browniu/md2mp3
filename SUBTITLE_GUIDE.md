# 字幕功能使用指南 🎵

## 功能介绍

本工具现在支持生成 **LRC 格式字幕文件**，可以在播放音频时同步显示文本内容。

## 快速开始

### 1. 生成带字幕的音频

```bash
# 基础用法
python md2mp3.py file.md --subtitle

# 带语速调整
python md2mp3.py file.md --subtitle --rate 1.5

# 简写
python md2mp3.py file.md -s -r 1.5
```

### 2. 输出文件

运行后会生成两个文件：
- `file.mp3` - 音频文件
- `file.lrc` - 字幕文件（与音频同名）

### 3. 查看字幕同步效果

#### 方法一：使用项目自带播放器（推荐）

1. 用浏览器打开 `player.html`
2. 选择生成的 MP3 文件
3. 选择对应的 LRC 文件
4. 播放音频，查看字幕同步效果

#### 方法二：使用支持 LRC 的播放器

推荐以下播放器：
- **Windows**: Foobar2000, AIMP
- **Mac**: VOX, iTunes（需插件）
- **Android**: Poweramp, BlackPlayer
- **iOS**: Doppler

---

## LRC 格式说明

### 格式示例

```lrc
[00:00.00]这是第一句话
[00:03.50]这是第二句话
[00:07.20]这是第三句话
```

### 时间戳格式

- `[mm:ss.xx]` - 分钟:秒.厘秒
- 例如：`[01:23.45]` 表示 1分23秒45

---

## 时间估算原理

由于 Google TTS 不提供时间轴信息，本工具使用 **智能时间估算** 方法：

### 估算公式

```
时长 = (字符数 / 语速) / 语速倍率 + 标点停顿时间
```

### 语速参数（字符/秒）

| 语言 | 基础语速 |
|------|---------|
| 中文 | 4.5 字/秒 |
| 英文 | 2.8 字/秒 |
| 日文 | 5.0 字/秒 |
| 韩文 | 4.0 字/秒 |

### 标点停顿时间

| 标点 | 停顿时长 |
|------|---------|
| 。！？ | 0.5 秒 |
| ，；： | 0.3 秒 |
| 换行 | 0.5 秒 |

### 语速倍率影响

- `--rate 1.5`：实际时长 = 估算时长 / 1.5
- `--rate 2.0`：实际时长 = 估算时长 / 2.0

---

## 准确性验证

### 测试步骤

1. 生成带字幕的音频：
```bash
python md2mp3.py example.md --subtitle --rate 1.5
```

2. 用浏览器打开 `player.html`

3. 加载生成的 `example.mp3` 和 `example.lrc`

4. 播放音频，观察：
   - ✅ 字幕是否与音频同步
   - ✅ 切换是否及时
   - ✅ 时间差是否在可接受范围

### 预期准确度

| 场景 | 准确度 | 说明 |
|------|--------|------|
| 正常语速 (1.0x) | ±0.5秒 | 误差较小 |
| 加速 (1.5x) | ±0.8秒 | 可接受 |
| 快速 (2.0x+) | ±1-2秒 | 可能需要手动调整 |

### 影响因素

- ✅ 标点使用规范 → 准确度更高
- ✅ 句子长度适中 → 估算更准
- ⚠️ 语速变化大 → 误差增加
- ⚠️ 多语言混合 → 需要调整

---

## 播放器功能

### 主要特性

- 🎵 **音频播放** - 标准 HTML5 audio 控件
- 📝 **字幕显示** - 实时同步高亮
- 🖱️ **点击跳转** - 点击字幕行跳转到对应时间
- 📊 **统计信息** - 显示总行数、当前行、总时长
- 🎨 **美观界面** - 渐变背景、平滑动画

### 使用技巧

1. **拖放文件**：可以直接拖拽文件到选择区域
2. **键盘控制**：使用空格键播放/暂停
3. **快速定位**：点击任意字幕行快速跳转
4. **自动滚动**：当前字幕始终居中显示

---

## 常见问题

### Q1: 字幕不同步怎么办？

**A**: 可能原因：
1. 文本分段不理想 → 调整标点符号
2. 语速估算偏差 → 尝试不同的 rate 值
3. 特殊内容影响 → 检查是否有大量数字、英文

**解决方案**：
- 调整 Markdown 源文件的标点使用
- 使用更合适的语速倍率
- 手动微调 LRC 文件的时间戳

---

### Q2: 如何手动调整字幕时间？

**A**: 直接编辑 LRC 文件：

```lrc
# 调整前
[00:10.00]这句话偏早了

# 调整后（延迟2秒）
[00:12.00]这句话偏早了
```

---

### Q3: 能否生成其他字幕格式？

**A**: 当前版本只支持 LRC 格式，因为：
- ✅ 简单易用
- ✅ 音乐播放器支持广泛
- ✅ 适合音频播放

未来版本可能支持：
- SRT（SubRip）- 用于视频
- VTT（WebVTT）- Web 标准

---

### Q4: 字幕文件是否支持中文？

**A**: 完全支持！
- LRC 文件使用 UTF-8 编码
- 支持所有 Unicode 字符
- 包括中文、日文、韩文、emoji 等

---

### Q5: 能否批量生成字幕？

**A**: 可以！创建批处理脚本：

**Windows**:
```batch
@echo off
for %%f in (*.md) do (
    python md2mp3.py "%%f" --subtitle --rate 1.5
)
```

**Linux/Mac**:
```bash
#!/bin/bash
for file in *.md; do
    python md2mp3.py "$file" --subtitle --rate 1.5
done
```

---

## 实际测试结果

基于 `example.md` 的测试：

| 指标 | 结果 |
|------|------|
| 总时长 | 约 28 秒 |
| 字幕行数 | 14 行 |
| 平均每行 | 2 秒 |
| 同步准确度 | ±0.5 秒 |
| 语速倍率 | 1.5x |

### 测试结论

✅ **基本满足需求**
- 字幕切换及时
- 时间误差在可接受范围
- 适合大多数使用场景

⚠️ **改进空间**
- 长句可能需要拆分
- 极速播放（2x+）误差较大
- 可以考虑添加音频分析校准

---

## 未来计划

### v1.3.0 可能包含

- [ ] 支持 SRT 格式
- [ ] 音频分析校准（可选）
- [ ] 自定义分段策略
- [ ] 时间偏移调整参数
- [ ] Web 版字幕编辑器

---

## 反馈

使用过程中有任何问题或建议，欢迎反馈！

**测试命令**：
```bash
# 生成测试文件
python md2mp3.py example.md --subtitle --rate 1.5

# 打开播放器验证
# 用浏览器打开 player.html
```

