<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown MP3 æ’­æ”¾å™¨ with å­—å¹•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .file-upload {
            padding: 30px;
            border-bottom: 1px solid #e0e0e0;
        }

        .upload-group {
            margin-bottom: 20px;
        }

        .upload-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-button {
            display: block;
            width: 100%;
            padding: 12px 20px;
            background: white;
            border: 2px dashed #667eea;
            border-radius: 10px;
            color: #667eea;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .file-input-button:hover {
            background: #f8f9ff;
            border-color: #764ba2;
        }

        .file-input-button.loaded {
            background: #667eea;
            color: white;
            border-style: solid;
        }

        .player {
            padding: 30px;
        }

        .audio-controls {
            text-align: center;
            margin-bottom: 30px;
        }

        audio {
            width: 100%;
            margin-bottom: 20px;
        }

        .lyrics-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            height: 400px;
            overflow-y: auto;
            position: relative;
        }

        .lyrics-container::-webkit-scrollbar {
            width: 8px;
        }

        .lyrics-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .lyrics-container::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .lyric-line {
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 10px;
            transition: all 0.3s;
            font-size: 16px;
            line-height: 1.8;
            color: #666;
            cursor: pointer;
        }

        .lyric-line:hover {
            background: #e9ecef;
        }

        .lyric-line.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .lyric-line.passed {
            color: #999;
        }

        .status {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .status-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 13px;
            color: #1976d2;
        }

        .info strong {
            display: block;
            margin-bottom: 5px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
            font-size: 13px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            display: block;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-data-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸµ Markdown MP3 æ’­æ”¾å™¨</h1>
            <p>æ”¯æŒ LRC å­—å¹•åŒæ­¥æ˜¾ç¤º</p>
        </div>

        <div class="file-upload">
            <div class="upload-group">
                <label>ğŸ“€ é€‰æ‹©éŸ³é¢‘æ–‡ä»¶ï¼ˆMP3ï¼‰</label>
                <div class="file-input-wrapper">
                    <input type="file" id="audioFile" accept=".mp3,audio/mpeg">
                    <div class="file-input-button" id="audioButton">
                        ç‚¹å‡»é€‰æ‹© MP3 æ–‡ä»¶
                    </div>
                </div>
            </div>

            <div class="upload-group">
                <label>ğŸ“ é€‰æ‹©å­—å¹•æ–‡ä»¶ï¼ˆLRCï¼‰</label>
                <div class="file-input-wrapper">
                    <input type="file" id="lrcFile" accept=".lrc,text/plain">
                    <div class="file-input-button" id="lrcButton">
                        ç‚¹å‡»é€‰æ‹© LRC æ–‡ä»¶
                    </div>
                </div>
            </div>

            <div class="info">
                <strong>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</strong>
                1. é€‰æ‹©ç”Ÿæˆçš„ MP3 éŸ³é¢‘æ–‡ä»¶<br>
                2. é€‰æ‹©å¯¹åº”çš„ LRC å­—å¹•æ–‡ä»¶<br>
                3. æ’­æ”¾éŸ³é¢‘ï¼ŒæŸ¥çœ‹å­—å¹•åŒæ­¥æ•ˆæœ<br>
                4. ç‚¹å‡»å­—å¹•è¡Œå¯ä»¥è·³è½¬åˆ°å¯¹åº”æ—¶é—´
            </div>
        </div>

        <div class="player">
            <div class="audio-controls" id="audioControls" style="display:none;">
                <audio id="audioPlayer" controls></audio>
            </div>

            <div class="lyrics-container" id="lyricsContainer">
                <div class="no-data">
                    <div class="no-data-icon">ğŸ¼</div>
                    <p>è¯·åŠ è½½éŸ³é¢‘å’Œå­—å¹•æ–‡ä»¶</p>
                </div>
            </div>
        </div>

        <div class="stats" id="stats" style="display:none;">
            <div class="stat-item">
                <span class="stat-value" id="totalLines">0</span>
                <span class="stat-label">å­—å¹•è¡Œæ•°</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="currentLine">0</span>
                <span class="stat-label">å½“å‰è¡Œ</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="duration">00:00</span>
                <span class="stat-label">æ€»æ—¶é•¿</span>
            </div>
        </div>
    </div>

    <script>
        let lyrics = [];
        let currentLyricIndex = -1;

        const audioFileInput = document.getElementById('audioFile');
        const lrcFileInput = document.getElementById('lrcFile');
        const audioButton = document.getElementById('audioButton');
        const lrcButton = document.getElementById('lrcButton');
        const audioPlayer = document.getElementById('audioPlayer');
        const audioControls = document.getElementById('audioControls');
        const lyricsContainer = document.getElementById('lyricsContainer');
        const stats = document.getElementById('stats');

        // å¤„ç†éŸ³é¢‘æ–‡ä»¶é€‰æ‹©
        audioFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                audioPlayer.src = url;
                audioControls.style.display = 'block';
                audioButton.textContent = `âœ“ ${file.name}`;
                audioButton.classList.add('loaded');
                
                audioPlayer.addEventListener('loadedmetadata', function() {
                    const duration = formatTime(audioPlayer.duration);
                    document.getElementById('duration').textContent = duration;
                });
            }
        });

        // å¤„ç†LRCæ–‡ä»¶é€‰æ‹©
        lrcFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    parseLRC(e.target.result);
                    lrcButton.textContent = `âœ“ ${file.name}`;
                    lrcButton.classList.add('loaded');
                };
                reader.readAsText(file);
            }
        });

        // è§£æLRCæ–‡ä»¶
        function parseLRC(lrcText) {
            lyrics = [];
            const lines = lrcText.split('\n');
            
            lines.forEach(line => {
                const match = line.match(/\[(\d{2}):(\d{2}\.\d{2})\](.*)/);
                if (match) {
                    const minutes = parseInt(match[1]);
                    const seconds = parseFloat(match[2]);
                    const time = minutes * 60 + seconds;
                    const text = match[3].trim();
                    
                    if (text) {
                        lyrics.push({ time, text });
                    }
                }
            });

            lyrics.sort((a, b) => a.time - b.time);
            displayLyrics();
            stats.style.display = 'flex';
            document.getElementById('totalLines').textContent = lyrics.length;
        }

        // æ˜¾ç¤ºæ­Œè¯
        function displayLyrics() {
            lyricsContainer.innerHTML = '';
            
            lyrics.forEach((lyric, index) => {
                const div = document.createElement('div');
                div.className = 'lyric-line';
                div.textContent = lyric.text;
                div.dataset.index = index;
                div.dataset.time = lyric.time;
                
                // ç‚¹å‡»è·³è½¬
                div.addEventListener('click', function() {
                    audioPlayer.currentTime = lyric.time;
                });
                
                lyricsContainer.appendChild(div);
            });
        }

        // æ›´æ–°å½“å‰æ­Œè¯é«˜äº®
        audioPlayer.addEventListener('timeupdate', function() {
            const currentTime = audioPlayer.currentTime;
            
            let newIndex = -1;
            for (let i = 0; i < lyrics.length; i++) {
                if (currentTime >= lyrics[i].time) {
                    newIndex = i;
                } else {
                    break;
                }
            }

            if (newIndex !== currentLyricIndex) {
                currentLyricIndex = newIndex;
                updateLyricHighlight();
                document.getElementById('currentLine').textContent = currentLyricIndex + 1;
            }
        });

        // æ›´æ–°æ­Œè¯é«˜äº®æ˜¾ç¤º
        function updateLyricHighlight() {
            const lyricLines = document.querySelectorAll('.lyric-line');
            
            lyricLines.forEach((line, index) => {
                line.classList.remove('active', 'passed');
                
                if (index === currentLyricIndex) {
                    line.classList.add('active');
                    // æ»šåŠ¨åˆ°å½“å‰è¡Œ
                    line.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else if (index < currentLyricIndex) {
                    line.classList.add('passed');
                }
            });
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
    </script>
</body>
</html>

